<script >
$(function () {
    WfForm.bindDetailFieldChangeEvent("field6866",function(id,rowIndex,value){
			$("#field6837_"+rowIndex).val('')
			$("#field6838_"+rowIndex).val('')
			$("#field6839_"+rowIndex).val('')
			$("#field6840_"+rowIndex).val('')
			$("#field11268_"+rowIndex).val('')
			$("#field6841_"+rowIndex).val('')
			$("#field6844_"+rowIndex).val('')
			$("#field11489_"+rowIndex).val('')
			$("#field6849_"+rowIndex).val('')
			$("#field6850_"+rowIndex).val('')
			$("#field6851_"+rowIndex).val('')
			$("#field6852_"+rowIndex).val('')
			$("#field6853_"+rowIndex).val('')
			$("#field11912_"+rowIndex).val('')
			$("#field6854_"+rowIndex).val('')
			$("#field11913_"+rowIndex).val('')
			$("#field6855_"+rowIndex).val('')
			$("#field6856_"+rowIndex).val('')
			$("#field6857_"+rowIndex).val('')
			$("#field6858_"+rowIndex).val('')
			$("#field6859_"+rowIndex).val('')
			$("#field6860_"+rowIndex).val('')
			$("#field6861_"+rowIndex).val('')
			$("#field6862_"+rowIndex).val('')
			$("#field6863_"+rowIndex).val('')
			$("#field6864_"+rowIndex).val('')
			$("#field6865_"+rowIndex).val('')
			$("#field6870_"+rowIndex).val('')
		  $("#field11968_"+rowIndex).val('')
		  $("#field12055_"+rowIndex).val('')
    });



    var persons = $("#field8751").val()
    var times = $("#field8753").val()
    jQuery.ajax({
        type: "Get",
        data: "MainTableName=formtable_main_12&DetailTableName=formtable_main_12_dt1&person=" + persons + "&time=" + times,
        dataType: "json",
        async: "false",
        url: "/api/WorkflowGetHrData/RDC/getJjHoursFilled",
        success: function (res) {
            if (res != null && res != '') {
                $("#field8756").val(res.HoursFilledSum)
            } else {
                $("#field8756").val(0)
            }
        },
        error: function (e) {
            $(".etype_29_swapDiv").children("div").remove()
            $(".etype_29_swapDiv").append("<div style='color:red'>已报工时数据获取异常!</div>")
        }
    })
    var empNo = $("#field8752").val()
    var date = $("#field8753").val()
    var sfwx = $("#field9537").val() //是否外协
    if (sfwx == '是') {
        jQuery.ajax({
            type: "Get",
            data: "id=" + empNo + "&date=" + date,
            dataType: "json",
            async: "false",
            url: "/api/WorkflowGetHrData/RDC/getWXHrData",
            success: function (res) {
                if (res != null && res != '') {
                    $("#field8754").val(res.realWorkTime)
                    $("#field8755").val(res.flag)
                } else {
                    $(".etype_29_swapDiv").children("div").remove()
                    $(".etype_29_swapDiv").append("<div style='color:red'>未获取到当前用户HR考勤数据!</div>")
                }
            },
            error: function (e) {
                $(".etype_29_swapDiv").children("div").remove()
                $(".etype_29_swapDiv").append("<div style='color:red'>当前用户HR考勤数据获取异常!</div>")
            }
        })
    } else if (sfwx = '否') {
        jQuery.ajax({
            type: "Get",
            data: "id=" + empNo + "&date=" + date,
            dataType: "json",
            async: "false",
            url: "/api/WorkflowGetHrData/RDC/getHrDataNBY",
            success: function (res) {
                if (res != null && res != '') {
                    $("#field8754").val(res.realWorkTime)
                    $("#field8755").val(res.flag)
                } else {
                    $(".etype_29_swapDiv").children("div").remove()
                    $(".etype_29_swapDiv").append("<div style='color:red'>未获取到当前用户HR考勤数据!</div>")
                }
            },
            error: function (e) {
                $(".etype_29_swapDiv").children("div").remove()
                $(".etype_29_swapDiv").append("<div style='color:red'>当前用户HR考勤数据获取异常!</div>")
            }
        })
    }
    function add(num1, num2) {
        const num1Digits = (num1.toString().split('.')[1] || '').length;
        const num2Digits = (num2.toString().split('.')[1] || '').length;
        const baseNum = Math.pow(10, Math.max(num1Digits, num2Digits));
        return (num1 * baseNum + num2 * baseNum) / baseNum;
    }
    //时间发生变化
    WfForm.bindFieldChangeEvent("field8753", function (obj, id, value) {
        $(".etype_29_swapDiv").children("div").remove()
        var persons = $("#field8751").val()
        var times = value
        jQuery.ajax({
            type: "Get",
            data: "MainTableName=formtable_main_12&DetailTableName=formtable_main_12_dt1&person=" + persons + "&time=" + times,
            dataType: "json",
            async: "false",
            url: "/api/WorkflowGetHrData/RDC/getJjHoursFilled",
            success: function (res) {
                if (res != null && res != '') {
                    $("#field8756").val(res.HoursFilledSum)
                } else {
                    $("#field8756").val(0)
                }
            },
            error: function (e) {
                $(".etype_29_swapDiv").children("div").remove()
                $(".etype_29_swapDiv").append("<div style='color:red'>已报工时数据获取异常!</div>")
            }
        })
        var empNo = $("#field8752").val()
        var date = value
        var sfwx = $("#field9537").val() //是否外协
        if (sfwx == '是') {
            jQuery.ajax({
                type: "Get",
                data: "id=" + empNo + "&date=" + date,
                dataType: "json",
                async: "false",
                url: "/api/WorkflowGetHrData/RDC/getWXHrData",
                success: function (res) {
                    if (res != null && res != '') {
                        $("#field8754").val(res.realWorkTime)
                        $("#field8755").val(res.flag)
                    } else {
                        $(".etype_29_swapDiv").children("div").remove()
                        $(".etype_29_swapDiv").append("<div style='color:red'>未获取到当前用户HR考勤数据!</div>")
                    }
                },
                error: function (e) {
                    $(".etype_29_swapDiv").children("div").remove()
                    $(".etype_29_swapDiv").append("<div style='color:red'>当前用户HR考勤数据获取异常!</div>")
                }
            })
        } else if (sfwx = '否') {
            jQuery.ajax({
                type: "Get",
                data: "id=" + empNo + "&date=" + date,
                dataType: "json",
                async: "false",
                url: "/api/WorkflowGetHrData/RDC/getHrDataNBY",
                success: function (res) {
                    if (res != null && res != '') {
                        $("#field8754").val(res.realWorkTime)
                        $("#field8755").val(res.flag)
                    } else {
                        $(".etype_29_swapDiv").children("div").remove()
                        $(".etype_29_swapDiv").append("<div style='color:red'>未获取到当前用户HR考勤数据!</div>")
                    }
                },
                error: function (e) {
                    $(".etype_29_swapDiv").children("div").remove()
                    $(".etype_29_swapDiv").append("<div style='color:red'>当前用户HR考勤数据获取异常!</div>")
                }
            })
        }
    })
    //人员发生变化
    WfForm.bindFieldChangeEvent("field8751", function (obj, id, value) {
        $(".etype_29_swapDiv").children("div").remove()
        var persons = value
        var times = $("#field8753").val()
        jQuery.ajax({
            type: "Get",
            data: "MainTableName=formtable_main_12&DetailTableName=formtable_main_12_dt1&person=" + persons + "&time=" + times,
            dataType: "json",
            async: "false",
            url: "/api/WorkflowGetHrData/RDC/getJjHoursFilled",
            success: function (res) {
                if (res != null && res != '') {
                    $("#field8756").val(res.HoursFilledSum)
                } else {
                    $("#field8756").val(0)
                }
            },
            error: function (e) {
                $(".etype_29_swapDiv").children("div").remove()
                $(".etype_29_swapDiv").append("<div style='color:red'>已报工时数据获取异常!</div>")
            }
        })
        var empNo = $("#field8752").val()
        var date = $("#field8753").val()
        var sfwx = $("#field9537").val() //是否外协
        if (sfwx == '是') {
            jQuery.ajax({
                type: "Get",
                data: "id=" + empNo + "&date=" + date,
                dataType: "json",
                async: "false",
                url: "/api/WorkflowGetHrData/RDC/getWXHrData",
                success: function (res) {
                    if (res != null && res != '') {
                        $("#field8754").val(res.realWorkTime)
                        $("#field8755").val(res.flag)
                    } else {
                        $(".etype_29_swapDiv").children("div").remove()
                        $(".etype_29_swapDiv").append("<div style='color:red'>未获取到当前用户HR考勤数据!</div>")
                    }
                },
                error: function (e) {
                    $(".etype_29_swapDiv").children("div").remove()
                    $(".etype_29_swapDiv").append("<div style='color:red'>当前用户HR考勤数据获取异常!</div>")
                }
            })
        } else if (sfwx = '否') {
            jQuery.ajax({
                type: "Get",
                data: "id=" + empNo + "&date=" + date,
                dataType: "json",
                async: "false",
                url: "/api/WorkflowGetHrData/RDC/getHrDataNBY",
                success: function (res) {
                    if (res != null && res != '') {
                        $("#field8754").val(res.realWorkTime)
                        $("#field8755").val(res.flag)
                    } else {
                        $(".etype_29_swapDiv").children("div").remove()
                        $(".etype_29_swapDiv").append("<div style='color:red'>未获取到当前用户HR考勤数据!</div>")
                    }
                },
                error: function (e) {
                    $(".etype_29_swapDiv").children("div").remove()
                    $(".etype_29_swapDiv").append("<div style='color:red'>当前用户HR考勤数据获取异常!</div>")
                }
            })
        }
    })

    WfForm.registerCheckEvent(WfForm.OPER_SUBMIT, function(callback){
    var len = $("#oTable0").children("tbody").children("tr").length
    for(var i=2;i<len-1;i++){
        var id1 = $($($("#oTable0").children("tbody").children("tr")[i]).children("td")[4]).children().children().children("input").attr("id")
        var id2 = $($($("#oTable0").children("tbody").children("tr")[i]).children("td")[5]).children().children().children("input").attr("id")
		var id3 = $($($("#oTable0").children("tbody").children("tr")[i]).children("td")[7]).children().children().children("input").attr("id")
		var id4 = $($($("#oTable0").children("tbody").children("tr")[i]).children("td")[21]).children().children().children("input").attr("id")
		var id5 = $($($("#oTable0").children("tbody").children("tr")[i]).children("td")[2]).children().children().children("input").attr("id")
        var  scddh = $("#"+id1).val()
        var  hh = $("#"+id2).val()
        var  rs  = $("#"+id5).val()
		var  sl = $("#"+id3).val()
		var a = i-1 ;
		var  txsl = $("#"+id4).val()
        if(rs=='0'||rs=='3'||rs=='4'){
          jQuery.ajax({
            type:"Get",
            data: "scddh="+scddh+"&sl="+sl+"&txsl="+txsl+"&hh="+hh,
            dataType:"json",
            async:false,
            url:"/api/WorkflowGetHrData/RDC/determineDataIsOverStep",
            success:function(res){
                if(res!=null){
					var flag = res.result
					console.log(flag)
					if(flag==0){
						callback();
					}else if(flag ==1){
						if(confirm("第"+a+"行明细填写完成数量超过所选生产订单的总生产数量，请确认是否提交！")){
							callback();
						}
					}
                }
            },
        })
        }else if(rs=='1'||rs=='2'){
          callback();
        }
    }
});

	function compareTime1(time1,time2){
		var date = new Date()
		var a = time1.split(":")
		var b = time2.split(":")
		return date.setHours(a[0],a[1]) <= date.setHours(b[0],b[1]);
	}
	function compareTime2(time1,time2){
		var date = new Date()
		var a = time1.split(":")
		var b = time2.split(":")
		return date.setHours(a[0],a[1]) >= date.setHours(b[0],b[1]);
	}
	function add (num1,num2){
         const num1Digits = (num1.toString().split('.')[1] || '').length;
         const num2Digits = (num2.toString().split('.')[1] || '').length;
         const baseNum = Math.pow(10, Math.max(num1Digits, num2Digits));
         return (num1 * baseNum + num2 * baseNum) / baseNum;
     }
  function  CalData(time1,time2){
    if(time1!=''&&time2!=''){
        var arr1 = time1.split(":")
        var arr2 = time2.split(":")
        var a = Number(arr1[0])*60 + Number(arr1[1])
        var b = Number(arr2[0])*60 + Number(arr2[1])
        return b-a;
    }
}
function changeByFlag(rowIndex,value) {
    var start1 =  $("#field6862_"+rowIndex).val()
    var end1 = $("#field6863_"+rowIndex).val()
    var sjsj = $("#field6864_"+rowIndex).val()
    var sjc = $("#field12371_"+rowIndex).val()
    // var time = add(sjsj,60)
    var time1 = $("#field12654_"+rowIndex).val()
    var time = add(time1,60)
    if(start1!=''&&end1!=''&&value=='0'&&sjsj!=time){
        var flag1 = compareTime1(start1,'12:00') //true
        var flag2 = compareTime2(end1,'13:30')	//true
        var flag3 = compareTime1(start1,'18:00')	//true
        var flag4 = compareTime2(end1,'18:30')	//true
        var flag5 = compareTime1(start1,'3:30')	//true
        var flag6 = compareTime2(end1,'4:30')	//true
        if(flag1==true&&flag2==true||flag3==true&&flag4==true||flag5==true&&flag6==true){
            //var t1 = $("#field6864_"+rowIndex).val()
            //var t2 = add(t1,60)
            $("#field6864_"+rowIndex).val(time)
        }
    }else if(start1!=''&&end1!=''&&value=='1'&&sjsj!=time1){
        $("#field6864_"+rowIndex).val(time1)
    }else if(start1!=''&&end1!=''&&value=='0'&&sjsj==time){
        $("#field6864_"+rowIndex).val(time)
    }else if(start1!=''&&end1!=''&&value==''&&sjsj==time){
        $("#field6864_"+rowIndex).val(time1)
    }
}
WfForm.bindDetailFieldChangeEvent("field6862",function(id,rowIndex,value){
    var  start = value
    var  end = $("#field6863_"+rowIndex).val()
    var  sjc = CalData(start,end)  //时间差
    //<= compareTime1(a,b)    >=compareTime2(a,b)
    // [18:30-23:59] [0:00-2:30] [4:30-12:00] [13:30-18:00] [18:30-23:59]
    if(compareTime2(start,"18:30")==true&&compareTime1(end,"23:59")==true||compareTime2(start,"00:00")==true&&compareTime1(end,"02:30")==true||
        compareTime2(start,"04:30")==true&&compareTime1(end,"12:00")==true||compareTime2(start,"13:30")==true&&compareTime1(end,"18:00")==true){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"02:30")&&compareTime1(end,"04:30")){
        var data = CalData("02:30",end);
        var res = Number(sjc)-Number(data);
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"04:30")&&compareTime1(end,"12:00")){
        var res = Number(sjc)-Number(120)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        var res = Number(sjc)-Number(120)-Number(CalData("12:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res  = Number(sjc)-Number(120)-Number(90)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc)-Number(120)-Number(90) -Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc)-Number(120)-Number(90) -Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"02:30")&&compareTime1(end,"04:30")){
        $("#field6864_"+rowIndex).val(0);
        $("#field12654_"+rowIndex).val(0);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"04:30")&&compareTime1(end,"12:00")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(CalData("12:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(90)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(90)-Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(90)-Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"04:30")&&compareTime1(end,"12:00")){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        var res = Number(sjc) -Number(CalData("12:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res = Number(sjc) -Number(90)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(90)-Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(90)-Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        $("#field6864_"+rowIndex).val(0);
        $("#field12654_"+rowIndex).val(0);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res = Number(sjc) -Number(CalData(start,"13:30"))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(CalData(start,"13:30"))-Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(CalData(start,"13:30"))-Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"13:30")&&compareTime1(start,"18:00")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"13:30")&&compareTime1(start,"18:00")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"13:30")&&compareTime1(start,"18:00")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"18:00")&&compareTime1(start,"18:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        $("#field6864_"+rowIndex).val(0);
        $("#field12654_"+rowIndex).val(0);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"18:00")&&compareTime1(start,"18:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"18:30")&&compareTime1(start,"23:59")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }
});
WfForm.bindDetailFieldChangeEvent("field6863",function(id,rowIndex,value){
    var  start = $("#field6862_"+rowIndex).val()
    var  end = value
    var  sjc = CalData(start,end)  //时间差
    // [18:30-23:59] [0:00-2:30] [4:30-12:00] [13:30-18:00] [18:30-23:59]
    if(compareTime2(start,"18:30")==true&&compareTime1(end,"23:59")==true||compareTime2(start,"00:00")==true&&compareTime1(end,"02:30")==true||
        compareTime2(start,"04:30")==true&&compareTime1(end,"12:00")==true||compareTime2(start,"13:30")==true&&compareTime1(end,"18:00")==true){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"02:30")&&compareTime1(end,"04:30")){
        var data = CalData("02:30",end);
        var res = Number(sjc)-Number(data);
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"04:30")&&compareTime1(end,"12:00")){
        var res = Number(sjc)-Number(120)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        var res = Number(sjc)-Number(120)-Number(CalData("12:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res  = Number(sjc)-Number(120)-Number(90)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc)-Number(120)-Number(90) -Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"00:00")&&compareTime1(start,"02:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc)-Number(120)-Number(90) -Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"02:30")&&compareTime1(end,"04:30")){
        $("#field6864_"+rowIndex).val(0);
        $("#field12654_"+rowIndex).val(0);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"04:30")&&compareTime1(end,"12:00")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(CalData("12:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(90)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(90)-Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"02:30")&&compareTime1(start,"04:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(CalData(start,"04:30"))-Number(90)-Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"04:30")&&compareTime1(end,"12:00")){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        var res = Number(sjc) -Number(CalData("12:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res = Number(sjc) -Number(90)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(90)-Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"04:30")&&compareTime1(start,"12:00")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(90)-Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"12:00")&&compareTime1(end,"13:30")){
        $("#field6864_"+rowIndex).val(0);
        $("#field12654_"+rowIndex).val(0);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        var res = Number(sjc) -Number(CalData(start,"13:30"))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(CalData(start,"13:30"))-Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"12:00")&&compareTime1(start,"13:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(CalData(start,"13:30"))-Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"13:30")&&compareTime1(start,"18:00")&&compareTime2(end,"13:30")&&compareTime1(end,"18:00")){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"13:30")&&compareTime1(start,"18:00")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        var res = Number(sjc) -Number(CalData("18:00",end))
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"13:30")&&compareTime1(start,"18:00")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else  if(compareTime2(start,"18:00")&&compareTime1(start,"18:30")&&compareTime2(end,"18:00")&&compareTime1(end,"18:30")){
        $("#field6864_"+rowIndex).val(0);
        $("#field12654_"+rowIndex).val(0);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"18:00")&&compareTime1(start,"18:30")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        var res = Number(sjc) -Number(30)
        $("#field6864_"+rowIndex).val(res);
        $("#field12654_"+rowIndex).val(res);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }else if(compareTime2(start,"18:30")&&compareTime1(start,"23:59")&&compareTime2(end,"18:30")&&compareTime1(end,"23:59")){
        $("#field6864_"+rowIndex).val(sjc);
        $("#field12654_"+rowIndex).val(sjc);
        var value1 = $("#field6861_"+rowIndex).val()
        changeByFlag(rowIndex,value1)
    }
})

	 WfForm.bindDetailFieldChangeEvent("field6861",function(id,rowIndex,value){
	        var start1 =  $("#field6862_"+rowIndex).val()
	        var end1 = $("#field6863_"+rowIndex).val()
	        var sjsj = $("#field6864_"+rowIndex).val()
		    	var sjc = $("#field12371_"+rowIndex).val()
			   // var time = add(sjsj,60)
			    var time1 = $("#field12654_"+rowIndex).val()
			    var time = add(time1,60)
        	if(start1!=''&&end1!=''&&value=='0'&&sjsj!=time){
		          var flag1 = compareTime1(start1,'12:00') //true
		          var flag2 = compareTime2(end1,'13:30')	//true
		          var flag3 = compareTime1(start1,'18:00')	//true
		          var flag4 = compareTime2(end1,'18:30')	//true
		          var flag5 = compareTime1(start1,'3:30')	//true
	            var flag6 = compareTime2(end1,'4:30')	//true
		          if(flag1==true&&flag2==true||flag3==true&&flag4==true||flag5==true&&flag6==true){
			            //var t1 = $("#field6864_"+rowIndex).val()
			            //var t2 = add(t1,60)
			            $("#field6864_"+rowIndex).val(time)
		          }
	      }else if(start1!=''&&end1!=''&&value=='1'&&sjsj!=time1){
			       $("#field6864_"+rowIndex).val(time1)
	      }else if(start1!=''&&end1!=''&&value=='0'&&sjsj==time){
	          $("#field6864_"+rowIndex).val(time)
	      }else if(start1!=''&&end1!=''&&value==''&&sjsj==time){
	          $("#field6864_"+rowIndex).val(time1)
	      }
    });
})
</script>

